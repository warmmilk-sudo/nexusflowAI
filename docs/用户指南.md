# NexusFlow AI - 用户指南

## 🚀 快速开始

### 系统要求
- Node.js >= 18.0.0
- npm >= 9.0.0
- Google Gemini API Key

### 3 步快速启动

#### 第 1 步：安装依赖
```bash
# 克隆项目
git clone <repository-url>
cd nexusflow-ai

# 安装所有依赖（推荐）
npm run install:all

# 或者分别安装
npm run install:frontend
npm run install:backend
```

#### 第 2 步：启动服务

**方式一：同时启动（推荐）**
```bash
npm run dev
```

**方式二：分别启动**
```bash
# 终端 1 - 启动后端
npm run dev:backend

# 终端 2 - 启动前端
npm run dev:frontend
```

看到这些信息说明成功：
```
✅ 系统初始化完成
🔧 使用模拟邮件连接器（开发模式）
📚 已加载 3 个文档
✅ RAG 引擎初始化成功
🚀 服务器运行在端口 3001
➜  Local:   http://localhost:3000/
```

#### 第 3 步：配置系统设置

1. 访问 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 登录并创建 API Key
3. 在浏览器打开 `http://localhost:3000`
4. 点击左侧导航栏的 "设置"
5. **语言设置**：选择"中文"或"English"
6. **API 配置**：粘贴你的 Gemini API Key
7. **邮箱配置**（可选）：配置收发邮件的邮箱账号
8. 分别点击对应的 "保存" 按钮

---

## 🎯 核心功能使用

### 智能收件箱
1. 点击左侧 "智能收件箱"
2. 选择一封模拟邮件
3. 点击 "AI Analysis & Draft"
4. 查看 AI 生成的回复草稿和引用来源
5. 编辑（如需要）
6. 点击 "批准并发送"

**特性**:
- ✅ 自动意图识别（销售/技术/支持/垃圾）
- ✅ 基于知识库生成专业回复
- ✅ 引用文档来源追溯
- ✅ 置信度评分

### 批量外发
1. 点击左侧 "批量外发"
2. 上传 CSV 文件（或使用模拟数据）
3. 配置活动类型和产品描述
4. 点击 "Start Generation"
5. 等待批量生成完成
6. 点击 "Preview" 查看每封邮件
7. 批准并发送

**CSV 格式**:
```csv
name,email,position,company,painPoint
张伟,zhang@example.com,CTO,科技公司,成本过高
```

### 知识库管理
1. 点击左侧 "知识库"
2. 查看已加载的文档列表
3. 查看存储使用率

**默认知识库包含**:
- 📄 术后护理指南.txt
- 📄 预约流程.txt
- 📄 常见问题FAQ.txt

---

## ⚙️ 系统配置

### 多语言设置
- 支持中文/英文界面切换
- 在设置页面选择语言
- 实时切换，本地存储偏好

### API Key 配置
- 获取地址：https://makersuite.google.com/app/apikey
- 本地存储，安全传输
- 支持密码保护显示

### 邮箱配置
支持配置真实邮箱进行邮件收发：

#### Gmail 配置
- IMAP: `imap.gmail.com:993`
- SMTP: `smtp.gmail.com:587`
- 需要启用"应用专用密码"

#### Outlook 配置
- IMAP: `outlook.office365.com:993`
- SMTP: `smtp.office365.com:587`
- 支持 Office 365 账号

#### 安全特性
- ✅ 本地存储配置
- ✅ 密码输入保护
- ✅ 连接自动测试
- ✅ 详细错误提示

---

## 🛠️ 常见问题

### 安装问题

**Q1: 后端依赖安装失败？**
```bash
# 使用安全安装（只安装核心依赖）
cd backend
npm run install-safe

# 或查看详细故障排查
cat backend/TROUBLESHOOTING.md
```

**Q2: 前端无法连接后端？**
```bash
# 测试后端是否运行
curl http://localhost:3001/api/health

# 应该返回：
# {"status":"operational",...}
```

**Q3: API Key 不工作？**
1. 确认在 Settings 页面保存了 Key
2. 打开浏览器控制台（F12）
3. 查看 Application → Local Storage
4. 确认 `nexusflow_api_key` 存在

**Q4: 知识库没有内容？**
```bash
# 检查知识库目录
ls backend/knowledge_base/

# 如果为空，重启后端会自动创建
npm run dev:backend
```

### 使用技巧

**提高 AI 回复质量**:
- 在知识库中添加更多相关文档
- 使用清晰的文档结构和标题
- 定期更新知识库内容

**优化邮件生成**:
- 在 CSV 中提供详细的客户痛点
- 编写具体的产品上下文描述
- 选择合适的活动类型

---

## 🚀 生产环境部署

### 前端部署

#### 构建生产版本
```bash
npm run build
```

#### 部署到 Vercel
```bash
npm install -g vercel
cd frontend
vercel --prod
```

#### 部署到 Netlify
```bash
npm install -g netlify-cli
cd frontend
netlify deploy --prod --dir=dist
```

### 后端部署

#### 使用 PM2（推荐）
```bash
# 安装 PM2
npm install -g pm2

# 启动服务
cd backend
pm2 start index.js --name nexusflow-server

# 查看状态
pm2 status

# 设置开机自启
pm2 startup
pm2 save
```

#### 使用 Docker
```dockerfile
# backend/Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
EXPOSE 3001
CMD ["node", "index.js"]
```

```bash
cd backend
docker build -t nexusflow-server .
docker run -d -p 3001:3001 --name nexusflow nexusflow-server
```

### 环境变量配置

创建 `.env.local` 文件：
```env
# 前端环境变量
VITE_API_BASE_URL=http://localhost:3001

# 后端环境变量
PORT=3001
NODE_ENV=production
```

---

## 📊 性能优化

### 前端优化
- 使用 Vite 快速构建
- 组件按需加载
- 图表库优化
- Service Worker 缓存

### 后端优化
- API 响应缓存（Redis）
- 速率限制
- 负载均衡
- 数据库连接池

---

## 🔐 安全建议

### 开发环境
- ✅ API Key 存储在 localStorage
- ✅ 通过 Header 传递
- ✅ 不在代码中硬编码

### 生产环境
- ⚠️ 使用后端环境变量
- ⚠️ 实现用户认证
- ⚠️ 启用 HTTPS
- ⚠️ 设置 CORS 白名单
- ⚠️ 添加速率限制

---

## 📞 获取帮助

### 文档资源
- **开发文档**: `docs/开发文档.md`
- **项目说明**: `docs/项目说明.md`

### 问题反馈
- GitHub Issues
- 提供错误信息和复现步骤

### 技术支持
- 查看浏览器控制台错误
- 检查后端日志输出
- 参考故障排查文档

---

**最后更新**: 2024年12月10日  
**版本**: v1.1.0