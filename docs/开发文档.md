# NexusFlow AI - å¼€å‘æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**NexusFlow AI** æ˜¯ä¸€ä¸ªåŸºäº AI çš„æ™ºèƒ½é‚®ä»¶åŠ©æ‰‹ç³»ç»Ÿï¼Œæ—¨åœ¨é€šè¿‡ Google Gemini å¤§è¯­è¨€æ¨¡å‹è‡ªåŠ¨å¤„ç†ç¹æ‚çš„åŒ»ç–—/å•†åŠ¡é‚®ä»¶ï¼Œå®ç°ä»"é˜…è¯»"åˆ°"è‰æ‹Ÿå›å¤"çš„è‡ªåŠ¨åŒ–ï¼Œä½†ä¿ç•™äººå·¥ç¡®è®¤çš„æ§åˆ¶æƒã€‚

### æ ¸å¿ƒç†å¿µ
- **æ™ºèƒ½æ„ŸçŸ¥**ï¼šè‡ªåŠ¨åˆ†ç±»ã€æ‘˜è¦ã€æ„å›¾è¯†åˆ«
- **çŸ¥è¯†å¢å¼º**ï¼šåŸºäº RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯ï¼Œç»“åˆä¼ä¸šçŸ¥è¯†åº“ç”Ÿæˆç²¾å‡†å›å¤
- **äººæœºååŒ**ï¼šAI ä½œä¸ºå‰¯é©¾é©¶ï¼Œäººç±»ä¿æŒæœ€ç»ˆå†³ç­–æƒ
- **è‡ªåŠ¨åŒ–æµæ°´çº¿**ï¼šä»æ”¶ä»¶åˆ°è‰æ‹Ÿå›å¤çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ ˆ

#### å‰ç«¯ (frontend/)
- **æ¡†æ¶**: React 19 + TypeScript
- **æ„å»ºå·¥å…·**: Vite 6
- **æ ·å¼**: Tailwind CSS
- **å›¾æ ‡**: Lucide React
- **å›¾è¡¨**: Recharts
- **AI é›†æˆ**: Google Gemini API

#### åç«¯ (backend/)
- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Express
- **AI å¼•æ“**: Google Gemini API
- **é‚®ä»¶å¤„ç†**: IMAP/SMTP (nodemailer)
- **æ–‡æ¡£å¤„ç†**: æ–‡æœ¬è§£æå’Œåˆ†å—

### é¡¹ç›®ç»“æ„

```
nexusflow-ai/
â”œâ”€â”€ ğŸ“ frontend/             # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â””â”€â”€ Sidebar.tsx      # ä¾§è¾¹æ å¯¼èˆª
â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx    # ä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ Inbound.tsx      # æ™ºèƒ½æ”¶ä»¶ç®±
â”‚   â”‚   â”œâ”€â”€ Outbound.tsx     # æ‰¹é‡å¤–å‘
â”‚   â”‚   â”œâ”€â”€ KnowledgeBase.tsx # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”‚   â””â”€â”€ Settings.tsx     # è®¾ç½®ä¸­å¿ƒ
â”‚   â”œâ”€â”€ services/            # API æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ geminiService.ts # Gemini API è°ƒç”¨
â”‚   â”œâ”€â”€ src/                 # æºç 
â”‚   â”‚   â””â”€â”€ i18n/            # å›½é™…åŒ–é…ç½®
â”‚   â”œâ”€â”€ types.ts             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ App.tsx              # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â””â”€â”€ package.json         # å‰ç«¯ä¾èµ–
â”œâ”€â”€ ğŸ“ backend/              # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ knowledge_base/      # çŸ¥è¯†åº“æ–‡æ¡£å­˜å‚¨
â”‚   â”œâ”€â”€ index.js             # Express æœåŠ¡å™¨
â”‚   â”œâ”€â”€ emailConnector.js    # é‚®ä»¶è¿æ¥å™¨
â”‚   â”œâ”€â”€ ragEngine.js         # RAG æ£€ç´¢å¼•æ“
â”‚   â””â”€â”€ package.json         # åç«¯ä¾èµ–
â”œâ”€â”€ ğŸ“ docs/                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ ğŸ“ scripts/              # è„šæœ¬å’Œå·¥å…·
â””â”€â”€ package.json             # é¡¹ç›®æ ¹é…ç½®
```

---

## ğŸ¯ åŠŸèƒ½æ¨¡å—è¯¦è§£

### 1. æ™ºèƒ½æ”¶ä»¶ç®± (Inbound)

**æ–‡ä»¶**: `frontend/pages/Inbound.tsx`

#### åŠŸèƒ½ç‰¹æ€§
- **è‡ªåŠ¨åˆ†ç±»ä¸æ ‡ç­¾**ï¼šAI è‡ªåŠ¨è¯†åˆ«é‚®ä»¶æ„å›¾å¹¶æ‰“æ ‡ç­¾
- **ä¸€å¥è¯æ‘˜è¦**ï¼šåœ¨åˆ—è¡¨ç›´æ¥æ˜¾ç¤º 50 å­—æ ¸å¿ƒå†…å®¹æ‘˜è¦
- **æ™ºèƒ½å›å¤**ï¼šåŸºäºçŸ¥è¯†åº“è‡ªåŠ¨ç”Ÿæˆä¸“ä¸šå›å¤è‰ç¨¿
- **æ¥æºè¿½æº¯**ï¼šæ˜ç¡®æ ‡æ³¨å¼•ç”¨çš„çŸ¥è¯†åº“æ–‡æ¡£

#### å·¥ä½œæµç¨‹
```
æ”¶åˆ°é‚®ä»¶ â†’ ç”¨æˆ·é€‰æ‹©é‚®ä»¶ â†’ ç‚¹å‡»"AI Analysis" 
â†’ åç«¯è°ƒç”¨ Gemini åˆ†ææ„å›¾ 
â†’ RAG æ£€ç´¢çŸ¥è¯†åº“ 
â†’ ç”Ÿæˆå›å¤è‰ç¨¿ 
â†’ å‰ç«¯å±•ç¤ºï¼ˆå¯ç¼–è¾‘ï¼‰
â†’ ç”¨æˆ·å®¡æ ¸ â†’ ç‚¹å‡»"æ‰¹å‡†å¹¶å‘é€"
```

### 2. æ‰¹é‡å¤–å‘ (Outbound)

**æ–‡ä»¶**: `frontend/pages/Outbound.tsx`

#### åŠŸèƒ½ç‰¹æ€§
- **CSV å¯¼å…¥**ï¼šæ‰¹é‡ä¸Šä¼ å®¢æˆ·ä¿¡æ¯
- **è¶…ä¸ªæ€§åŒ–**ï¼šåŸºäºå®¢æˆ·ç—›ç‚¹ç”Ÿæˆå®šåˆ¶åŒ–é‚®ä»¶
- **æ´»åŠ¨é…ç½®**ï¼šæ”¯æŒå¤šç§æ´»åŠ¨ç±»å‹
- **æ‰¹é‡ç”Ÿæˆ**ï¼šä¸€é”®ç”Ÿæˆæ•°ç™¾å°ä¸ªæ€§åŒ–é‚®ä»¶

### 3. çŸ¥è¯†åº“ç®¡ç† (Knowledge Base)

**æ–‡ä»¶**: `frontend/pages/KnowledgeBase.tsx`

#### åŠŸèƒ½ç‰¹æ€§
- **æ–‡æ¡£ç®¡ç†**ï¼šæ”¯æŒ PDFã€DOCXã€TXT æ ¼å¼
- **è‡ªåŠ¨åˆ†å—**ï¼šæ™ºèƒ½åˆ‡åˆ†æ–‡æ¡£ä¾¿äºæ£€ç´¢
- **è¯­ä¹‰æœç´¢**ï¼šåŸºäºå…³é”®è¯çš„ç›¸å…³å†…å®¹æ£€ç´¢
- **å®æ—¶ç»Ÿè®¡**ï¼šç›‘æ§å­˜å‚¨ä½¿ç”¨ç‡å’Œæ–‡æ¡£æ•°é‡

### 4. æ•°æ®ä»ªè¡¨ç›˜ (Dashboard)

**æ–‡ä»¶**: `frontend/pages/Dashboard.tsx`

#### åŠŸèƒ½ç‰¹æ€§
- **å…³é”®æŒ‡æ ‡**ï¼šæ€»è§¦è¾¾é‡ã€å›å¤ç‡ã€å¾…å¤„ç†è‰ç¨¿ã€æ´»è·ƒçº¿ç´¢
- **è¶‹åŠ¿åˆ†æ**ï¼šæ¯å‘¨é‚®ä»¶å‘é€é‡ vs å›å¤é‡å›¾è¡¨
- **å¿«æ·æ“ä½œ**ï¼šä¸€é”®è·³è½¬åˆ°å„åŠŸèƒ½æ¨¡å—

### 5. è®¾ç½®ä¸­å¿ƒ (Settings)

**æ–‡ä»¶**: `frontend/pages/Settings.tsx`

#### åŠŸèƒ½ç‰¹æ€§
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šä¸­æ–‡/è‹±æ–‡ç•Œé¢åˆ‡æ¢
- **API é…ç½®**ï¼šç®¡ç† Gemini API Key
- **é‚®ç®±é…ç½®**ï¼šè®¾ç½®æ”¶å‘é‚®ä»¶çš„é‚®ç®±è´¦å·
- **æœ¬åœ°å­˜å‚¨**ï¼šæ‰€æœ‰é…ç½®ä»…å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°

---

## ğŸ”Œ API æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://localhost:3001/api`
- **Content-Type**: `application/json`
- **è®¤è¯æ–¹å¼**: API Key (é€šè¿‡ Header `x-api-key` ä¼ é€’)

### ä¸»è¦ç«¯ç‚¹

#### 1. å¥åº·æ£€æŸ¥
```http
GET /api/health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "operational",
  "services": {
    "emailConnector": "ready",
    "ragEngine": "ready"
  },
  "timestamp": "2024-12-10T10:30:00.000Z"
}
```

#### 2. ç”Ÿæˆå¤–å‘é‚®ä»¶è‰ç¨¿
```http
POST /api/outbound/generate
```

**è¯·æ±‚å¤´**:
```http
x-api-key: YOUR_GEMINI_API_KEY
```

**è¯·æ±‚ä½“**:
```json
{
  "customer": {
    "name": "å¼ ä¼Ÿ",
    "position": "æŠ€æœ¯æ€»ç›‘",
    "company": "ç§‘æŠ€å…¬å¸",
    "painPoint": "äº‘åŸºç¡€è®¾æ–½æˆæœ¬è¿‡é«˜"
  },
  "focus": "New Product Launch",
  "productContext": "NexusFlow æ˜¯ä¸€ä¸ª AI é©±åŠ¨çš„è‡ªåŠ¨åŒ–å·¥å…·..."
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "draft": "å°Šæ•¬çš„å¼ æ€»ç›‘ï¼Œ\n\næˆ‘æ³¨æ„åˆ°è´µå…¬å¸åœ¨äº‘åŸºç¡€è®¾æ–½æˆæœ¬æ–¹é¢é¢ä¸´æŒ‘æˆ˜..."
}
```

#### 3. åˆ†æå…¥ç«™é‚®ä»¶å¹¶ç”Ÿæˆå›å¤
```http
POST /api/inbound/analyze
```

**è¯·æ±‚ä½“**:
```json
{
  "email": {
    "fromName": "ææ˜",
    "subject": "æœ¯åå‘çƒ§å’¨è¯¢",
    "content": "åŒ»ç”Ÿæ‚¨å¥½ï¼Œæˆ‘æœ¯åç¬¬äºŒå¤©ä½“æ¸©37.8åº¦ï¼Œè¯·é—®æ­£å¸¸å—ï¼Ÿ"
  }
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "intent": "Support",
  "draft": "æ‚¨å¥½ææ˜å…ˆç”Ÿï¼Œ\n\næ„Ÿè°¢æ‚¨çš„å’¨è¯¢ã€‚æ ¹æ®æœ¯åæŠ¤ç†æŒ‡å—...",
  "confidence": 95,
  "sources": ["æœ¯åæŠ¤ç†æŒ‡å—.txt", "å¸¸è§é—®é¢˜FAQ.txt"]
}
```

#### 4. é…ç½®é‚®ç®±è®¾ç½®
```http
POST /api/email/configure
```

**è¯·æ±‚ä½“**:
```json
{
  "email": "your-email@gmail.com",
  "password": "your-app-password",
  "imapHost": "imap.gmail.com",
  "smtpHost": "smtp.gmail.com",
  "senderName": "Your Name"
}
```

#### 5. å…¶ä»–ç«¯ç‚¹
- `POST /api/email/summarize` - ç”Ÿæˆé‚®ä»¶æ‘˜è¦
- `POST /api/email/send` - å‘é€é‚®ä»¶
- `GET /api/knowledge/stats` - çŸ¥è¯†åº“ç»Ÿè®¡
- `POST /api/knowledge/upload` - ä¸Šä¼ æ–‡æ¡£
- `POST /api/knowledge/search` - æœç´¢çŸ¥è¯†åº“

---

## ğŸ§  æ ¸å¿ƒç®—æ³•

### RAG æ£€ç´¢å¼•æ“

**æ–‡ä»¶**: `backend/ragEngine.js`

#### å·¥ä½œåŸç†
1. **æ–‡æ¡£åˆ†å—**ï¼šå°†é•¿æ–‡æ¡£åˆ‡åˆ†ä¸ºå¯æ£€ç´¢çš„å—
2. **å…³é”®è¯æå–**ï¼šä»æŸ¥è¯¢ä¸­æå–å…³é”®è¯
3. **ç›¸ä¼¼åº¦åŒ¹é…**ï¼šåŸºäºå…³é”®è¯åŒ¹é…è®¡ç®—ç›¸å…³æ€§åˆ†æ•°
4. **ç»“æœæ’åº**ï¼šæŒ‰ç›¸å…³æ€§åˆ†æ•°æ’åºå¹¶è¿”å›å‰ K ä¸ªç»“æœ

#### æ ¸å¿ƒä»£ç 
```javascript
// æ–‡æ¡£åˆ†å—
chunkDocument(content, chunkSize = 500) {
  const chunks = [];
  const sentences = content.split(/[ã€‚ï¼ï¼Ÿ\n]+/);
  // ... åˆ†å—é€»è¾‘
  return chunks;
}

// è¯­ä¹‰æ£€ç´¢
async search(query, topK = 3) {
  const results = [];
  const queryKeywords = this.extractKeywords(query);
  // ... æ£€ç´¢é€»è¾‘
  return results.sort((a, b) => b.score - a.score).slice(0, topK);
}
```

### é‚®ä»¶è¿æ¥å™¨

**æ–‡ä»¶**: `backend/emailConnector.js`

#### åŠŸèƒ½æ¨¡å—
- **IMAP è¿æ¥å™¨**ï¼šæ¥æ”¶é‚®ä»¶
- **SMTP è¿æ¥å™¨**ï¼šå‘é€é‚®ä»¶
- **æ¨¡æ‹Ÿè¿æ¥å™¨**ï¼šå¼€å‘æ¨¡å¼ä½¿ç”¨

---

## ğŸŒ å¤šè¯­è¨€ç³»ç»Ÿ

### å›½é™…åŒ–é…ç½®

**æ–‡ä»¶**: `frontend/src/i18n/index.ts`

#### æ”¯æŒè¯­è¨€
- ä¸­æ–‡ (zh)
- è‹±æ–‡ (en)

#### ä½¿ç”¨æ–¹å¼
```typescript
import { useTranslation } from 'src/i18n';

const MyComponent = () => {
  const t = useTranslation();
  return <h1>{t.pages.dashboard}</h1>;
};
```

#### ç¿»è¯‘ç»“æ„
```typescript
interface Translations {
  common: { save: string; cancel: string; };
  nav: { dashboard: string; settings: string; };
  pages: { dashboard: string; welcome: string; };
  // ... æ›´å¤šç¿»è¯‘
}
```

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### ç¯å¢ƒè®¾ç½®
```bash
# å®‰è£…ä¾èµ–
npm run install:all

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œæµ‹è¯•
npm test
```

### ä»£ç è§„èŒƒ
- **ç»„ä»¶å‘½å**ï¼šPascalCase (å¦‚ `Dashboard.tsx`)
- **å‡½æ•°å‘½å**ï¼šcamelCase (å¦‚ `generateDraft`)
- **å¸¸é‡å‘½å**ï¼šUPPER_SNAKE_CASE (å¦‚ `API_BASE_URL`)

### Git å·¥ä½œæµ
```bash
# åŠŸèƒ½å¼€å‘
git checkout -b feature/new-feature
git commit -m "feat: add new feature"

# ä¿®å¤ bug
git checkout -b fix/bug-description
git commit -m "fix: resolve bug issue"
```

### æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **é›†æˆæµ‹è¯•**ï¼šAPI ç«¯ç‚¹
- **E2E æµ‹è¯•**ï¼šå…³é”®ç”¨æˆ·æµç¨‹

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### Customer (å®¢æˆ·)
```typescript
interface Customer {
  id: string;
  name: string;
  email: string;
  position: string;
  company: string;
  painPoint?: string;
  status: 'pending' | 'processing' | 'completed' | 'failed';
  generatedDraft?: string;
}
```

### InboundEmail (å…¥ç«™é‚®ä»¶)
```typescript
interface InboundEmail {
  id: string;
  fromName: string;
  fromEmail: string;
  subject: string;
  content: string;
  receivedAt: string;
  status: 'unread' | 'analyzing' | 'drafted' | 'replied';
  intent?: 'Sales' | 'Technical' | 'Support' | 'Spam';
  draftReply?: string;
  confidence?: number;
  summary?: string;
  sources?: string[];
}
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒ
```bash
npm run dev
```

### ç”Ÿäº§æ„å»º
```bash
npm run build
```

### Docker éƒ¨ç½²
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM node:18-alpine AS production
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/backend ./backend
EXPOSE 3001
CMD ["node", "backend/index.js"]
```

---

## ğŸ” å®‰å…¨è€ƒè™‘

### API å®‰å…¨
- API Key é€šè¿‡ Header ä¼ é€’
- è¯·æ±‚é€Ÿç‡é™åˆ¶
- CORS é…ç½®

### æ•°æ®å®‰å…¨
- æœ¬åœ°å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- HTTPS ä¼ è¾“åŠ å¯†

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- ç»„ä»¶æ‡’åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥

### åç«¯ä¼˜åŒ–
- API å“åº”ç¼“å­˜
- æ•°æ®åº“è¿æ¥æ± 
- è´Ÿè½½å‡è¡¡

---

## ğŸ› è°ƒè¯•æŒ‡å—

### å‰ç«¯è°ƒè¯•
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- React DevTools
- ç½‘ç»œè¯·æ±‚ç›‘æ§

### åç«¯è°ƒè¯•
- Node.js è°ƒè¯•å™¨
- æ—¥å¿—è¾“å‡º
- API æµ‹è¯•å·¥å…·

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ10æ—¥  
**ç‰ˆæœ¬**: v1.1.0