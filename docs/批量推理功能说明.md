# 批量推理功能说明

## 概述

NexusFlow AI 现在支持使用 Doubao 批量推理API来生成外发邮件草稿，大幅提升批量处理效率。

## 功能特性

### 批量处理
- **最大批次大小**: 8个客户/批次
- **并发处理**: 同一批次内的客户并发生成邮件
- **自动分批**: 超过8个客户时自动分成多个批次处理
- **进度显示**: 实时显示当前批次和处理进度

### 性能优化
- **思考长度**: 设置为最短，提升响应速度
- **批次间延迟**: 1秒延迟避免API限制
- **错误处理**: 单个客户失败不影响整个批次

### 智能生成
- **RAG集成**: 自动检索知识库相关内容
- **个性化**: 根据客户职位、公司、痛点定制内容
- **多语言**: 支持中英文邮件生成
- **活动焦点**: 支持产品介绍和合作机会两种模式

## 使用流程

1. **上传客户列表**: CSV格式，包含姓名、邮箱、职位、公司等信息
2. **配置活动参数**: 选择活动焦点和产品上下文
3. **开始批量生成**: 点击"开始生成"按钮
4. **实时监控**: 查看批次进度和生成状态
5. **预览编辑**: 生成完成后可预览和编辑每封邮件
6. **批量发送**: 确认无误后批量发送邮件

## 技术实现

### 后端API
- `POST /api/outbound/batch-generate`: 批量生成邮件草稿
- 支持最大8个客户的并发处理
- 集成RAG知识库检索
- 自动错误处理和重试机制

### 前端处理
- 自动分批处理大量客户数据
- 实时更新处理状态和进度
- 支持编辑和重新生成单个邮件
- 批量发送确认机制

## 性能指标

### 处理速度
- **单批次时间**: 约10-20秒（8个客户）
- **平均生成时间**: 2-3秒/客户
- **并发优势**: 比串行处理快5-8倍

### 成功率
- **正常情况**: >95%成功率
- **网络异常**: 自动重试机制
- **API限制**: 批次间延迟避免限流

## 最佳实践

### 客户数据准备
- 确保CSV格式正确
- 包含完整的客户信息
- 痛点信息有助于个性化

### 批量大小建议
- **小批量**: 1-20个客户，适合测试
- **中批量**: 20-100个客户，日常使用
- **大批量**: 100+个客户，分多次处理

### 质量控制
- 生成后逐一预览重要客户的邮件
- 根据需要编辑和优化内容
- 测试发送前先发送给内部邮箱

## 故障排除

### 常见问题
1. **批次失败**: 检查网络连接和API配置
2. **生成质量差**: 优化产品上下文描述
3. **处理缓慢**: 减少批次大小或检查服务器负载

### 错误处理
- 单个客户失败不影响其他客户
- 失败的客户可以单独重新生成
- 详细错误日志便于问题诊断