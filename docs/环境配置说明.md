# 环境配置说明

## 概述

系统已将所有LLM模型配置移至环境变量中，无需在前端Settings页面配置API密钥。

## 环境变量配置

在项目根目录的 `.env.local` 文件中配置以下变量：

```bash
# 火山引擎API配置
VOLCENGINE_API_KEY=your_volcengine_api_key_here
VOLCENGINE_API_BASE=https://ark.cn-beijing.volces.com/api/v3

# LLM模型配置
DEEPSEEK_MODEL=doubao-seed-1-6-251015
DOUBAO_EMBEDDING_MODEL=doubao-embedding-text-240715

# 服务器配置
PORT=3001
```

## 配置步骤

### 1. 获取火山引擎API密钥

1. 访问 [火山引擎控制台](https://console.volcengine.com/)
2. 进入 ARK 平台
3. 创建API密钥
4. 确保有DeepSeek和Doubao模型的访问权限

### 2. 更新环境变量

将获取的API密钥填入 `.env.local` 文件：

```bash
VOLCENGINE_API_KEY=sk-your-actual-api-key-here
```

### 3. 重启服务

更新环境变量后，需要重启后端服务：

```bash
cd backend
npm start
```

## 功能说明

### 自动配置
- 系统启动时自动读取环境变量
- RAG引擎自动启用embedding模式（如果有API密钥）
- 无需前端配置，开箱即用

### 模型使用
- **DeepSeek-v3.2**: 用于邮件生成和分析
- **Doubao Embedding**: 用于知识库语义搜索

### 安全性
- API密钥存储在服务器环境变量中
- 前端无法访问API密钥
- 更安全的配置方式

## 故障排除

### 1. API密钥错误
如果看到API相关错误，检查：
- `.env.local` 文件中的API密钥是否正确
- 火山引擎账户是否有足够余额
- 模型访问权限是否正确

### 2. 模型不可用
如果模型调用失败：
- 检查模型名称是否正确
- 确认模型在你的地区可用
- 验证账户权限

### 3. 环境变量未生效
- 确保 `.env.local` 文件在项目根目录
- 重启后端服务
- 检查文件编码为UTF-8

## 开发模式

开发时可以使用以下命令启动：

```bash
# 后端开发模式（自动重启）
cd backend
npm run dev

# 前端开发模式
cd frontend
npm run dev
```

## 生产部署

生产环境中，建议：
1. 使用系统环境变量而非 `.env.local` 文件
2. 定期轮换API密钥
3. 监控API使用量和成本
4. 设置适当的访问控制